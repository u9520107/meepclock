"use strict";function isFocusTime(e,t){if(t.size>0){var i=function(){var i=60*e.getHours()+e.getMinutes();return{v:!t.every(function(e){return!(e.get("start")<=i&&e.get("end")>i)})}}();if("object"==typeof i)return i.v}return!1}function parseFocusTimes(){var e=void 0===arguments[0]?[]:arguments[0];return Array.isArray(e)||(e=[e]),e.map(function(e){return e=e.split("~").map(function(e){return e=e.split(":").map(function(e){return~~e}),60*e[0]+e[1]}),{start:e[0],end:e[1]}})}var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"],_inherits=require("babel-runtime/helpers/inherits")["default"],_createClass=require("babel-runtime/helpers/create-class")["default"],_core=require("babel-runtime/core-js")["default"],_interopRequire=require("babel-runtime/helpers/interop-require")["default"],StoreBase=_interopRequire(require("meepworks/store-base")),Im=_interopRequire(require("immutable")),SetFocustimes=_interopRequire(require("../actions/set-focustimes")),UpdateTime=_interopRequire(require("../actions/update-time")),ClientInit=_interopRequire(require("../actions/client-init")),DATA=_core.Symbol(),INTERNAL=_core.Symbol(),TimeStore=function(e){function t(){_classCallCheck(this,t),this[DATA]=Im.fromJS({now:new Date,parsedFocusTimes:[],focusTimes:[],delay:0,focus:!1})}return _inherits(t,e),_createClass(t,{rehydrate:{value:function(e){e.now=new Date(e.now),e.parsedFocusTimes=parseFocusTimes(e.focusTimes),this[DATA]=Im.fromJS(e)}},dehydrate:{value:function(){var e=this[DATA].toJS();return e.now=e.now.getTime(),e}},handlers:{get:function(){return[{action:SetFocustimes.symbol,handler:this.handleSetFocus},{action:UpdateTime.symbol,handler:this.handleUpdateTime},{action:ClientInit.symbol,handler:this.handleClientInit}]}},handleSetFocus:{value:function(){var e=this,t=void 0===arguments[0]?[]:arguments[0];Array.isArray(t)||(t=[t]),this[DATA]=this[DATA].withMutations(function(i){var r=Im.fromJS(parseFocusTimes(t));i.set("focusTimes",Im.fromJS(t)).set("parsedFocusTimes",r).set("focus",isFocusTime(e[DATA].get("now"),r))}),this.emit("change")}},handleUpdateTime:{value:function(){var e=this;this[DATA]=this[DATA].withMutations(function(t){var i=(new Date).getTime(),r=e[DATA].get("delay");r>0&&(r-=5,r>0&&(i-=r)),i=new Date(i),t.set("now",i).set("delay",r).set("focus",isFocusTime(i,e[DATA].get("parsedFocusTimes")))}),this.emit("change")}},handleClientInit:{value:function(){var e=new Date,t=e.getTime()-this[DATA].get("now").getTime();this[DATA]=this[DATA].set("delay",t)}},state:{get:function(){return this[DATA]}},now:{get:function(){return this[DATA].get("now")}}},{state:{get:function(){return this.getInstance()[DATA]}},now:{get:function(){return this.getInstance()[DATA].get("now")}}}),t}(StoreBase);module.exports=TimeStore;