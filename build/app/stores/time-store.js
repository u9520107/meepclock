"use strict";function isFocusTime(e,t){if(t.size>0){var i=function(){var i=60*e.getHours()+e.getMinutes();return{v:!t.every(function(e){return!(e.get("start")<=i&&e.get("end")>i)})}}();if("object"==typeof i)return i.v}return!1}function parseFocusTimes(){var e=void 0===arguments[0]?[]:arguments[0];return Array.isArray(e)||(e=[e]),e.map(function(e){return e=e.split("~").map(function(e){return e=e.split(":").map(function(e){return~~e}),60*e[0]+e[1]}),{start:e[0],end:e[1]}})}var _inherits=require("babel-runtime/helpers/inherits")["default"],_get=require("babel-runtime/helpers/get")["default"],_createClass=require("babel-runtime/helpers/create-class")["default"],_classCallCheck=require("babel-runtime/helpers/class-call-check")["default"],_Object$defineProperty=require("babel-runtime/core-js/object/define-property")["default"],_Symbol=require("babel-runtime/core-js/symbol")["default"],_interopRequireDefault=require("babel-runtime/helpers/interop-require-default")["default"];_Object$defineProperty(exports,"__esModule",{value:!0});var _StoreBase2=require("meepworks/store-base"),_StoreBase3=_interopRequireDefault(_StoreBase2),_Im=require("immutable"),_Im2=_interopRequireDefault(_Im),_SetFocustimes=require("../actions/set-focustimes"),_SetFocustimes2=_interopRequireDefault(_SetFocustimes),_UpdateTime=require("../actions/update-time"),_UpdateTime2=_interopRequireDefault(_UpdateTime),_ClientInit=require("../actions/client-init"),_ClientInit2=_interopRequireDefault(_ClientInit),DATA=_Symbol(),INTERNAL=_Symbol(),TimeStore=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this[DATA]=_Im2["default"].fromJS({now:new Date,parsedFocusTimes:[],focusTimes:[],delay:0,focus:!1})}return _inherits(t,e),_createClass(t,[{key:"rehydrate",value:function(e){e.now=new Date(e.now),e.parsedFocusTimes=parseFocusTimes(e.focusTimes),this[DATA]=_Im2["default"].fromJS(e)}},{key:"dehydrate",value:function(){var e=this[DATA].toJS();return e.now=e.now.getTime(),e}},{key:"handlers",get:function(){return[{action:_SetFocustimes2["default"],handler:this.handleSetFocus},{action:_UpdateTime2["default"],handler:this.handleUpdateTime},{action:_ClientInit2["default"],handler:this.handleClientInit}]}},{key:"handleSetFocus",value:function(){var e=this,t=void 0===arguments[0]?[]:arguments[0];Array.isArray(t)||(t=[t]),this[DATA]=this[DATA].withMutations(function(i){var r=_Im2["default"].fromJS(parseFocusTimes(t));i.set("focusTimes",_Im2["default"].fromJS(t)).set("parsedFocusTimes",r).set("focus",isFocusTime(e[DATA].get("now"),r))}),this.emit("change")}},{key:"handleUpdateTime",value:function(){var e=this;this[DATA]=this[DATA].withMutations(function(t){var i=(new Date).getTime(),r=e[DATA].get("delay");r>0&&(r-=5,r>0&&(i-=r)),i=new Date(i),t.set("now",i).set("delay",r).set("focus",isFocusTime(i,e[DATA].get("parsedFocusTimes")))}),this.emit("change")}},{key:"handleClientInit",value:function(){var e=new Date,t=e.getTime()-this[DATA].get("now").getTime();this[DATA]=this[DATA].set("delay",t)}},{key:"state",get:function(){return this[DATA]}},{key:"now",get:function(){return this[DATA].get("now")}}],[{key:"state",get:function(){return this.getInstance()[DATA]}},{key:"now",get:function(){return this.getInstance()[DATA].get("now")}}]),t}(_StoreBase3["default"]);exports["default"]=TimeStore,module.exports=exports["default"];